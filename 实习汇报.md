# 实习汇报（老师用）

## 一句话结论
本阶段已在 `SAIL/ACT` 方向完成 Zabha 测试支持的主体建设与分阶段验证，当前进入最终全量验收时被本地工具链能力限制阻塞；整体工作已形成可审计证据链和可恢复执行路径。

## 整体开发是怎么回事（简要）
本仓库为本地工作目录，目标是在 **riscv-arch-test (ACT)** 中为 **Zabha** 扩展补充测试并跑通自动化验证，最终交付 PR + CI。开发流程：在子仓库 `riscv-arch-test` 内编写/生成测试 → 用 `scripts` 下脚本分阶段执行（phase1～4 已完成，phase5 需支持 Zabha 的工具链）→ 在 fork 仓库配置 GitHub CI 与 OpenCode，以 CI 结果作为验收依据。当前阻塞点：本机工具链不支持 Zabha 指令，phase5 无法全量跑通；其余阶段与证据链已就绪。

## 项目目标
- 任务：为 `riscv-arch-test (ACT)` 增加 `Zabha` 扩展测试支持。
- 目标：补齐测试覆盖，形成可提交 PR 的工程化交付（代码 + 验证 + 汇报材料）。

## 本阶段已完成工作（我做了什么）
- 完成任务方向确认与规范对齐：
  - 明确选择 Zabha 作为实习主线任务。
  - 对齐任务范围：ACT 测试支持，不改核心 ISA 实现。
- 建立自动化执行与验收框架：
  - 形成分阶段自动执行入口与阶段心跳/日志机制。
  - 将“测试通过”设为阶段门禁标准，减少主观判断。
- 推进阶段性测试落地与验证：
  - `phase1~phase4` 已推进并完成（其中 phase4 显示 48/48，100%）。
  - 保留了阶段日志与运行记录，支持复盘与审计。
- 输出过程管理资产：
  - 维护了任务队列、运行日志、阶段状态文件与汇报文档，确保可交接、可恢复。

## 当前状态（按仓库事实）
- `docs/PH4_HEARTBEAT.md`：`done_chunks=48/48`，`progress=100%`。
- `docs/PH5_HEARTBEAT.md`：`status=blocked`，阻塞原因是本地 `riscv64-unknown-elf-gcc/binutils` 不支持 Zabha opcode。
- 结论：阶段性交付已完成；最终“全量 Zabha 验收 + PR CI 通过”尚需补齐工具链条件。

## 最新进展（GitHub/OpenCode 集成）
- 已在 fork 仓库 `BoogieEnzo/riscv-arch-test` 的默认分支 `act4` 落地 `.github/workflows/opencode.yml`。
- OpenCode workflow 已改为使用 **API Key + Gemini 2.0 Flash**（不再使用 GCP/Vertex），需在仓库 Secrets 中配置 `GOOGLE_GENERATIVE_AI_API_KEY`。
- 已完成 GitHub App 安装与仓库授权；`/oc` 评论触发链路已打通（`issue_comment` 事件可触发 `opencode` workflow）。
- 当前状态：触发成功；若此前有失败，多为旧版 GCP/Vertex 配置，现方案为 API Key（或千问 `DASHSCOPE_API_KEY`），配置对齐后 `/oc` 应可稳定回评。
- 并行状态：见下「云端 CI 已跑通内容」。

### 云端 CI 已跑通内容（regression 工作流）
- **触发**：对 fork 仓库 `BoogieEnzo/riscv-arch-test` 的 push（如提交 opencode workflow 等）会触发 CI。
- **在云端做了什么**：GitHub Actions 按 `regress.yml` 执行完整回归流水线：先做 Pre-commit 检查，再并行跑 QEMU 回归（rv32-max / rv64-max）、Vector Testgen、Build CTP，以及多配置 Sail 回归（如 RVA20504、RVA22564、RVB23564、RV20U32/64、rv32/rv64-max 等），最后 Matrix 多 job 回归与 ci_pass 汇总；整条流水线约 **10 分钟** 内完成，状态为 **Success**。
- **产出**：生成 8 个 artifacts（如 RV120U32/RV120U64-logs、qemu-rv32/rv64-max-logs、rv32/rv64-max-logs、ctp.html、ctp.pdf），即各类回归日志与 CTP 报告，可作为客观证据。
- **说明**：部分 job 有「Cache save failed」注解，仅影响后续运行是否复用缓存，不影响本次 CI 通过；说明云端 CI 基础链路有效，可为后续 PR 合并与考核提供依据。

## 产出与价值
- 技术产出：
  - Zabha 测试主线框架与阶段化验证流程已建立。
  - 自动化脚本化执行降低了重复手工操作成本。
- 工程价值：
  - 问题可定位（有明确阻塞点）。
  - 过程可追踪（有日志、有状态、有门禁命令）。
  - 结果可复用（后续仅需替换/升级工具链即可继续推进）。

## 风险与阻塞
- 当前唯一硬阻塞：
  - 本机 GNU 工具链不支持 Zabha 指令编码，导致 phase5 无法完成全量汇编/验收链路。
- 影响：
  - 暂时无法在现有本机环境给出“full Zabha 全量通过”的最终截图与 CI 结果。

## 后续最小闭环计划
1. 切换到支持 Zabha 的 `riscv64-unknown-elf-gcc/binutils`。
2. 重新执行 phase5 全量验证并固化日志。
3. 确认仓库 Secret `GOOGLE_GENERATIVE_AI_API_KEY` 已配置，确保 `/oc` 可稳定成功回评。
4. 提交 PR，完成 CI，通过后准备技术汇报材料。

## 当前文件结构（便于汇报与判断目录必要性）

根目录一级结构（`tree -L 1`，按当前仓库实际）：

| 目录 | 说明 | 是否必需 |
|------|------|----------|
| `docs` | 实习报告、心跳文件、说明文档 | 需保留 |
| `riscv-arch-test` | ACT 仓库，Zabha 测试与 CI 均在此 | 需保留 |
| `sail-riscv` | 参考模型 sail_riscv_sim 的源码/构建 | 需保留 |
| `scripts` | 阶段化执行与诊断脚本 | 需保留 |
| `tools` | spike、工具链等构建/安装目录 | 需保留 |
| `docs/automation-logs` | 运行日志（已置于 docs 下） | 可保留 |

汇报时可说明：主线依赖上述五类必需目录；运行日志在 **docs/automation-logs**；目录结构无需重构。

## 对实习考核的对应关系
- 已满足：
  - 有实质技术工作，不是简单改动。
  - 有阶段验证和工程证据链。
- 待满足：
  - PR 合并链路的最终 CI 通过（依赖工具链条件）。
