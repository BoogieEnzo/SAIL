你现在是本机 coding agent，请在 `/home/fengde/SAIL` 继续执行 Zabha 主线任务。目标：在尽量少人工交互下，自循环推进任务，并以“测试验收”作为阶段完成标准。

## 0. 会话恢复（每次重启先做）
1. `cd /home/fengde/SAIL`
2. 读取并总结当前状态（禁止跳过）：
   - `docs/AGENT_STATE.json`
   - `docs/TASK_QUEUE.json`
   - `docs/RUN_LOG.md`
   - `docs/CONTEXT_BRIEF.md`（如存在）
3. 执行一次快速环境检查并记录结果（写入 `docs/RUN_LOG.md`）：
   - `command -v riscof spike sail_riscv_sim riscv64-unknown-elf-gcc || true`
   - `.venv`、`tools/spike`、`sail-riscv/build` 是否存在

## 1. 执行原则（硬性）
1. 非必要不提问：除非遇到“必须用户确认/授权/外网凭据/系统权限”才停。
2. 自循环执行：按任务队列顺序自动推进；每轮都回写状态与日志。
3. 频繁提交：每个可验证子任务完成后立即 commit，便于回滚。
4. 测试验收优先：每个阶段以测试命令或可复现检查通过作为 done 条件。
5. shell 环境是 `zsh`。

## 2. 任务状态同步规则
- 每轮任务都要同步三处：
  - `docs/AGENT_STATE.json`
  - `docs/TASK_QUEUE.json`
  - `docs/RUN_LOG.md`
- 状态值统一：`pending | in_progress | blocked | done`
- 若 blocked，必须记录：
  - 失败命令
  - 关键报错
  - 最小下一步

## 3. commit 规则（必须执行）
- 粒度：一个可验收子任务一个 commit。
- message 模板：
  - `chore(loop): ...`
  - `build(env): ...`
  - `test(riscof): ...`
  - `docs(state): ...`
- commit 前最少检查：
  - 相关脚本可执行
  - 对应验收命令已跑（成功或失败都有日志）

## 4. 当前项目快照（重启后先核对）
- 已有：
  - `riscof` 在 `.venv` 中可用
  - `spike` 目标路径：`/home/fengde/SAIL/tools/spike/bin/spike`
  - Zabha/Zacas 测试与部分配置已落地
- 主要阻塞：
  - `sail` / `sail_riscv_sim` 可能尚未就绪
  - 若外网不可用，`opam` 拉取依赖会失败
  - 现有 GNU toolchain 可能不支持 `zabha`（需以实际编译结果为准）

## 5. 默认执行顺序（继续开发时）
1. 先跑最小验收脚本（例如 `scripts/check_min.sh`）确认基线。
2. 按 `docs/TASK_QUEUE.json` 取下一个 `pending` 任务执行。
3. 执行任务对应验收命令（成功则 done，失败则 blocked+记录）。
4. 写日志、改状态、commit。
5. 进入下一任务，持续循环。

## 6. 输出要求（每轮结束）
仅输出 4 项：
1. 本轮变更文件列表（路径 + 一句话）
2. 本轮 commit hash + message
3. 任务状态变化（哪些从 pending/in_progress 变为 done/blocked）
4. 若 blocked：最多 3 条“最小人工操作步骤”

commit 不要太频繁！

严格执行以上规则，不要只给方案，直接动手。

