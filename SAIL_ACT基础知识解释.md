# SAIL/ACT 实习方向 - 基础知识解释

## 📚 核心概念解释

### 1. RISC-V 是什么？

**RISC-V** 是一个**开源的指令集架构（ISA）**，类似于：
- x86（Intel/AMD 处理器用的）
- ARM（手机芯片用的）

**简单理解**：
- 指令集 = CPU 能理解的"语言"
- RISC-V = 一套新的、开源的 CPU"语言标准"
- 任何人都可以基于这个标准设计自己的 CPU

**为什么重要**：
- 开源免费，不受专利限制
- 模块化设计，可以按需添加功能（扩展）
- 正在快速发展，很多公司都在用

---

### 2. SAIL 是什么？

**SAIL** 是一种**形式化规范语言**，用来精确描述指令集的行为。

**简单理解**：
- 就像用数学公式描述物理定律一样
- SAIL 用代码精确描述"CPU 执行每条指令时应该做什么"
- 这个描述是**官方标准**，所有 RISC-V CPU 都要遵守

**实际作用**：
```
传统方式：用自然语言写文档（容易有歧义）
  ↓
SAIL 方式：用代码写规范（精确、可执行、可验证）
```

**sail-riscv** 仓库：
- 存放 RISC-V 指令集的 SAIL 规范代码
- 这是**黄金参考实现**（Golden Reference）
- 其他 CPU 实现都要和它对比，确保行为一致

**sail** 仓库：
- SAIL 语言本身的编译器/工具链
- 可以把 SAIL 代码转换成可执行的 C/OCaml 代码

---

### 3. ACT 是什么？

**ACT** = **Architecture Compatibility Test**（架构兼容性测试）

**简单理解**：
- 一套**测试程序**，用来验证某个 CPU 是否符合 RISC-V 标准
- 就像"驾照考试"一样，CPU 必须通过 ACT 测试才能说自己是"RISC-V 兼容的"

**测试流程**：
```
1. 写测试程序（用汇编语言）
   ↓
2. 在待测 CPU 上运行，得到结果 A
   ↓
3. 在 SAIL 参考模型上运行，得到结果 B
   ↓
4. 对比 A 和 B
   - 如果一致 → CPU 符合标准 ✅
   - 如果不一致 → CPU 有 bug ❌
```

**ACT 仓库**：
- 存放所有 RISC-V 兼容性测试用例
- 包括基础指令、扩展指令的测试
- 需要不断添加新扩展的测试支持

---

### 4. 这个实习方向在做什么？

**总体目标**：为 RISC-V 生态系统做贡献，确保标准规范的正确性和完整性

**具体任务类型**：

#### 任务 1：为 SAIL 添加新功能
- **问题**：RISC-V 不断推出新扩展（如向量指令 V、加密指令 Zk 等）
- **任务**：在 sail-riscv 中实现这些新扩展的 SAIL 规范
- **例子**：如果某个扩展指令还没实现，你去实现它

#### 任务 2：为 ACT 添加新测试
- **问题**：新扩展需要新的测试用例
- **任务**：为未实现的扩展编写测试程序
- **例子**：写测试来验证某个指令的行为是否正确

#### 任务 3：修复 Bug
- **问题**：现有代码可能有错误
- **任务**：修复 sail-riscv 或 ACT 中的 bug
- **例子**：发现某个指令的行为和标准不一致，修复它

#### 任务 4：形式化验证研究
- **问题**：用数学方法证明 CPU 设计的正确性
- **工具**：isla（形式化验证工具）、litmus-tests（并发测试）
- **任务**：研究如何用形式化方法验证 RISC-V 实现

---

## 🔧 相关工具和技术栈

### 技术栈
- **SAIL 语言**：类似函数式编程语言，有类型系统
- **OCaml**：SAIL 编译器用 OCaml 实现
- **C 语言**：SAIL 可以生成 C 代码
- **RISC-V 汇编**：写测试用例需要
- **Git/GitHub**：代码管理和 PR 提交

### 开发工具
- **VSCode + SAIL 插件**：编写 SAIL 代码
- **RISC-V 工具链**：编译和运行测试
- **CI/CD**：自动测试（Lean/Rocq 是形式化验证工具）

---

## 📖 学习路径建议

### 第一步：理解 RISC-V 基础
1. 阅读 RISC-V 官方文档（基础指令集）
2. 了解什么是扩展（Extension）
3. 理解指令编码格式

### 第二步：学习 SAIL 语言
1. 阅读 [SAIL 语言手册](https://alasdair.github.io/manual.html)
2. 看 sail-riscv 仓库中的例子代码
3. 尝试理解现有指令的实现

### 第三步：了解 ACT 测试格式
1. 阅读 [ACT 开发指南](https://github.com/riscv-non-isa/riscv-arch-test/blob/act4/docs/DeveloperGuide.md)
2. 看现有的测试用例
3. 理解测试签名（signature）的概念

### 第四步：选择任务
1. 浏览 sail-riscv 和 ACT 仓库的 Issues
2. 查看已合并的 PR，了解工作模式
3. 选择一个合适的任务开始

---

## 💡 实际例子

### 例子 1：实现一个新指令
假设 RISC-V 新增了一个指令 `ADDW`（64位加法，结果截断到32位）

**在 SAIL 中**：
```sail
function clause execute (ADDW(rs1, rs2, rd)) = {
  let rs1_val = X(rs1);
  let rs2_val = X(rs2);
  let result = (rs1_val + rs2_val)[31..0];
  X(rd) = sign_extend(result);
  RETIRE_SUCCESS
}
```

**在 ACT 中**：
```assembly
# 测试 ADDW 指令
addi x1, x0, 100
addi x2, x0, 200
addw x3, x1, x2
# 检查 x3 是否等于 300
```

### 例子 2：修复一个 Bug
发现某个指令在边界情况下的行为不对，需要：
1. 找到 SAIL 代码中的问题
2. 修复它
3. 确保所有测试通过
4. 提交 PR

---

## 🎯 考核要求解读

1. **时间**：1-2 周（需要快速学习）
2. **提交 PR**：
   - 必须能编译通过，CI 测试通过
   - 代码质量要好（格式、注释、逻辑）
   - 不能太简单（比如只改个拼写错误）
   - 不能和别人重复
3. **技术报告**：
   - 30 分钟 PPT
   - 讲清楚：背景、问题、思路、难点、解决方案

---

## ❓ 常见问题

**Q: 我没有硬件背景，能做吗？**
A: 可以！这主要是软件工作，需要的是：
- 编程能力（SAIL/OCaml/C）
- 逻辑思维能力
- 学习能力

**Q: 需要什么前置知识？**
A: 
- 基本的计算机体系结构知识（指令、寄存器、内存）
- 编程经验（任何语言都可以）
- 汇编语言基础（可以边学边做）

**Q: 从哪里开始？**
A:
1. 先看 sail-riscv 仓库的 README
2. 找一个简单的已合并 PR，理解工作流程
3. 找一个简单的 Issue 或未实现的扩展
4. 开始实现

**Q: 难度如何？**
A: 
- 中等难度
- 需要快速学习新语言和概念
- 但任务范围很广，可以从简单开始

---

## 📚 推荐阅读顺序

1. **RISC-V 基础**（1-2天）
   - RISC-V 指令集手册第 1-2 章
   - 理解基础指令格式

2. **SAIL 语言**（2-3天）
   - SAIL 手册前几章
   - 看 sail-riscv 中的简单指令实现

3. **ACT 测试**（1-2天）
   - ACT 开发指南
   - 看几个测试用例

4. **选择任务**（1天）
   - 浏览 Issues
   - 选择合适难度的任务

5. **开始实现**（剩余时间）
   - 写代码
   - 测试
   - 提交 PR

---

## 🔗 快速链接

- [RISC-V 规范官网](https://riscv.org/technical/specifications/)
- [SAIL 语言手册](https://alasdair.github.io/manual.html)
- [sail-riscv 仓库](https://github.com/riscv/sail-riscv)
- [ACT 仓库](https://github.com/riscv-non-isa/riscv-arch-test/tree/act4)
- [ACT 开发指南](https://github.com/riscv-non-isa/riscv-arch-test/blob/act4/docs/DeveloperGuide.md)

---

**总结**：这是一个关于**用形式化方法定义和验证 CPU 指令集**的实习方向。核心是确保 RISC-V 标准的正确性和完整性，需要学习 SAIL 语言和测试方法，然后为开源项目做贡献。
